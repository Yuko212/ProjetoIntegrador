<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Pedido - CiberTech</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/detalhe.css">
    <link rel="stylesheet" href="../css/logout.css">
    <link rel="stylesheet" href="../css/footer-header.css">
</head>
<body>

    <script src="../js/auth.js"></script> 
    <header id="main-header">
        <div class="cabeÃ§alho">
            <a href="index.html" class="logo">
                <span class="logo-text">CiberTech</span>                
            </a>

            <nav class="main-nav">
                <a href="dashboard.html" class="nav-link">Home</a>
                <a href="peca.html" class="nav-link">Design</a>
                <a href="#acompanhamento" class="nav-link">Acompanhamento</a>
                <a href="#historico" class="nav-link">HistÃ³rico</a>
            </nav>

            <button class="botao-logout" onclick="logout()">
                Sair
            </button>
        </div>
    </header>

    <h1 class="titulo-pagina">Detalhes do pedido</h1>
            <div class="numero-pedido-badge"> NÂº do pedido: <span id="id-pedido">000</span>
            </div>
    
   <div class="container-geral"><main class="limitador-largura"> </main><main>

        <main class="area-conteudo">
            
            <section class="coluna-esquerda">
                
                <div class="cartao cartao-bloco-container"> <div class="cartao cartao-bloco" id="bloco-pino-1">
                    <span id="nome-bloco-pino-1" class="titulo-bloco">Pino 1: Carregando...</span>
                    
                    <div class="container-imagem-bloco">
                        <img src="../img/pngs/Base.png" alt="Imagem do Bloco" class="imagem-peca" id="imagem-pino-1">
                        <span class="badge-quantidade" id="quantidade-peca-p1">1</span>
                    </div>
                </div>
            
                <div class="cartao cartao-bloco" id="bloco-pino-2" style="display: none;">
                    <span id="nome-bloco-pino-2" class="titulo-bloco">Pino 2: Carregando...</span>
                    
                    <div class="container-imagem-bloco">
                        <img src="../img/pngs/Base.png" alt="Imagem do Bloco" class="imagem-peca" id="imagem-pino-2">
                        <span class="badge-quantidade" id="quantidade-peca-p2">1</span>
                    </div>
                </div>
            </div>

                <div class="cartao cartao-pessoal">
                    <div class="titulo-secao-fundo-escuro">
                        InformaÃ§Ãµes Pessoais
                    </div>

                    <div class="grupo-campo">
                        <label class="rotulo">E-mail</label>
                        <div id="info-email" class="campo-leitura"></div>
                    </div>

                    <div class="grupo-campo">
                        <label class="rotulo">Data do pedido</label>
                        <div id="info-data" class="campo-leitura"></div>
                    </div>
                </div>

                <a href="statuspedido.html" class="botao-acompanhamento">
                    <button type="button">Acompanhar Pedido</button>
                </a>

            </section>

            <section class="coluna-direita">
                
                <div class="cartao cartao-ordem">
                    <div class="titulo-secao-fundo-escuro">
                        Ordem escolhida:
                    </div>

                    <div class="grupo-pino">
                        <h3 class="titulo-pino">1Âº PINO</h3>
                        
                        <div class="linha-forma">
                            <span class="rotulo-forma">1Âº Forma</span>
                            <div id="p1-forma1" class="campo-leitura-forma"></div>
                        </div>
                        <div class="linha-forma">
                            <span class="rotulo-forma">2Âº Forma</span>
                            <div id="p1-forma2" class="campo-leitura-forma"></div>
                        </div>
                        <div class="linha-forma">
                            <span class="rotulo-forma">3Âº Forma</span>
                            <div id="p1-forma3" class="campo-leitura-forma"></div>
                        </div>
                    </div>

                    <div class="grupo-pino" id="container-pino-2">
                        <h3 class="titulo-pino">2Âº PINO</h3>
                        
                        <div class="linha-forma">
                            <span class="rotulo-forma">1Âº Forma</span>
                            <div id="p2-forma1" class="campo-leitura-forma"></div>
                        </div>
                        <div class="linha-forma">
                            <span class="rotulo-forma">2Âº Forma</span>
                            <div id="p2-forma2" class="campo-leitura-forma"></div>
                        </div>
                        <div class="linha-forma">
                            <span class="rotulo-forma">3Âº Forma</span>
                            <div id="p2-forma3" class="campo-leitura-forma"></div>
                        </div>
                    </div>

                </div>
            </section>

        </main>
</div>

<footer id="main-footer">
    <div class="container footer-container">
        <div class="footer-top">
            <p class="footer-logo">CiberTech</p>
            <nav class="footer-nav">
                <a href="#funcionalidades" class="footer-link">Funcionalidades</a>
                <a href="#" class="footer-link">Termos de Uso</a>
                <a href="#" class="footer-link">Contato</a>
            </nav>
        </div>
        <p class="footer-copy">
            &copy; 2025 CiberTech. Todos os direitos reservados.
        </p>
    </div>
</footer>

    

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ... (MAP_FORMAS e MAP_LETRAS permanecem iguais) ...

        verificarLogin();

        const MAP_FORMAS = {
            1: "Quadrado",
            2: "CÃ­rculo",
            3: "OctÃ³gono"
        };

        const MAP_LETRAS = {
            1: "Q", // Quadrado
            2: "C", // CÃ­rculo
            3: "O"  // OctÃ³gono
        };

        // --- FunÃ§Ãµes de UtilitÃ¡rio ---

        function getPedidoIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // FunÃ§Ã£o para gerar o nome do arquivo PNG baseado na ordem das peÃ§as (P1, P2, P3)
        function gerarNomeImagem(p1, p2, p3) {
            const letraP1 = MAP_LETRAS[p1] || '';
            const letraP2 = MAP_LETRAS[p2] || '';
            const letraP3 = MAP_LETRAS[p3] || '';

            const sequencia = letraP1 + letraP2 + letraP3;

            if (sequencia.length === 0) {
                 return "Cubo";
            }
            
            return sequencia; 
        }


        // --- FunÃ§Ãµes Principais ---

        function carregarDetalhes() {
            // ... (LÃ³gica de obtenÃ§Ã£o e fetch do pedido permanece igual) ...
            
            const pedidoId = getPedidoIdFromUrl();

            if (!pedidoId) {
                document.getElementById('id-pedido').innerText = 'ERRO';
                alert("ID do pedido nÃ£o encontrado na URL. Redirecionando.");
                window.location.href = "dashboard.html"; 
                return;
            }

            document.getElementById('id-pedido').innerText = pedidoId;

            fetch(`http://127.0.0.1:1880/pedido/${pedidoId}`) // ðŸ›‘ CORRIGIDO PARA /api/pedido/
                .then(res => {
                    if (!res.ok) throw new Error(`Falha ao buscar detalhes: ${res.status}`);
                    return res.json();
                })
                .then(pedido => {
                    if (!pedido || pedido.status === "error") {
                        throw new Error(pedido.message || "Pedido nÃ£o encontrado no banco de dados.");
                    }
                    
                    exibirDetalhesNaTela(pedido);
                })
                .catch(err => {
                    console.error("Erro na busca do pedido:", err);
                    alert("NÃ£o foi possÃ­vel carregar os detalhes do pedido.");
                    document.getElementById('nome-bloco').innerText = 'ERRO';
                });
        }

        function exibirDetalhesNaTela(pedido) {
            
            // VariÃ¡veis de controle de visibilidade
            const isDuplo = pedido.tipo_pedido == 2;
            const containerPino2 = document.getElementById('container-pino-2');
            const blocoPino2 = document.getElementById('bloco-pino-2'); // Novo ID/Elemento

            // --- CONTROLE DE VISIBILIDADE GERAL ---
            if (isDuplo) {
                blocoPino2.style.display = 'flex'; // Mostra o bloco 2 na esquerda
                containerPino2.style.display = 'block'; // Mostra a ordem 2 na direita
            } else {
                blocoPino2.style.display = 'none'; // Esconde o bloco 2 na esquerda
                containerPino2.style.display = 'none'; // Esconde a ordem 2 na direita
            }


            // --- PINO 1 (Bloco Esquerda e Ordem Direita) ---
            
            // TÃ­tulo
            document.getElementById('nome-bloco-pino-1').innerText = `Pino 1`;
            document.getElementById('quantidade-peca-p1').innerText = 1;

            // Imagem Pino 1
            const nomeBasePino1 = gerarNomeImagem(pedido.p1, pedido.p2, pedido.p3);
            document.getElementById('imagem-pino-1').src = `../img/pngs/${nomeBasePino1}.png`; 
            document.getElementById('imagem-pino-1').alt = `Pino 1: ${nomeBasePino1}`;

            // Ordem Pino 1
            document.getElementById('p1-forma1').innerText = MAP_FORMAS[pedido.p1];
            document.getElementById('p1-forma2').innerText = MAP_FORMAS[pedido.p2];
            document.getElementById('p1-forma3').innerText = MAP_FORMAS[pedido.p3];


            // --- PINO 2 (Bloco Esquerda e Ordem Direita) ---
            if (isDuplo) {
                // TÃ­tulo
                document.getElementById('nome-bloco-pino-2').innerText = `Pino 2`;
                document.getElementById('quantidade-peca-p2').innerText = 1;

                // Imagem Pino 2
                const nomeBasePino2 = gerarNomeImagem(pedido.p4, pedido.p5, pedido.p6);
                document.getElementById('imagem-pino-2').src = `../img/pngs/${nomeBasePino2}.png`;
                document.getElementById('imagem-pino-2').alt = `Pino 2: ${nomeBasePino2}`;

                // Ordem Pino 2
                document.getElementById('p2-forma1').innerText = MAP_FORMAS[pedido.p4];
                document.getElementById('p2-forma2').innerText = MAP_FORMAS[pedido.p5];
                document.getElementById('p2-forma3').innerText = MAP_FORMAS[pedido.p6];
            }


            // --- INFORMAÃ‡Ã•ES PESSOAIS (Comum) ---
            document.getElementById('info-email').innerText = pedido.email || 'E-mail nÃ£o disponÃ­vel';
            const dataOriginal = pedido.criado_em; 
            const dataFormatada = new Date(dataOriginal).toLocaleDateString('pt-BR');
            document.getElementById('info-data').innerText = dataFormatada;

        }

        // Executa o carregamento
        carregarDetalhes();
    });
</script>
</body>
</html>