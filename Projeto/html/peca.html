<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuração da Peça - CiberTech</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/peca.css"> 
    <link rel="stylesheet" href="../css/logout.css">
    <link rel="stylesheet" href="../css/footer-header.css">
    
</head>
<body>
    <script src="../js/auth.js"></script>
    <header id="main-header">
        <div class="cabeçalho">
            <a href="index.html" class="logo">
                <span class="logo-text">CiberTech</span>                
            </a>

            <nav class="main-nav">
                <a href="dashboard.html" class="nav-link">Home</a>
                <a href="peca.html" class="nav-link">Design</a>
                <a href="statuspedido.html" class="nav-link">Acompanhamento</a>
                <a href="historico.html" class="nav-link">Histórico</a>
            </nav>

            <button class="botao-logout" onclick="logout()">
                Sair
            </button>
        </div>
    </header>

    <main class="config-container">
        
        <section class="config-painel-esquerdo">
            <div class="config-card">
                <h2 class="config-card-titulo">Peça simples ou Dupla?</h2>
                
                <div class="opcao-radio">
                    <input type="radio" id="simples" name="tipo-peca" value="simples" class="checkbox-custom" checked>
                    <label for="simples" class="label-custom">
                        Simples <br> (1 pino com 3 formas)
                    </label>
                </div>

                <div class="opcao-radio">
                    <input type="radio" id="dupla" name="tipo-peca" value="dupla" class="checkbox-custom">
                    <label for="dupla" class="label-custom">
                        Dupla <br> (2 pinos com 3 formas cada)
                    </label>
                </div>
            </div>

            <button type="submit" class="botao-finalizar">Finalizar</button>

            <div id="painel-preview">
                <img id="preview-peca" class="preview-peca" src="../img/pngs/Base.png">
                <img id="preview-peca-2" class="preview-peca oculto" src="../img/pngs/Base.png">
            </div>
            
        </section>

        <section class="config-painel-direito" id="painel-configuracao">
            
            <div class="header-ordem">
                <h2 class="config-card-titulo">Escolha a ordem da sua peça</h2>
            </div>

            <div class="container-pinos">
                
                <div class="coluna-pino" id="coluna-pino-1">
                    <div class="titulo-pino">Ordem 1º pino</div>
                    
                    <div class="form-grupo">
                        <label class="label-dropdown">Primeira forma</label>
                        <div class="dropdown-container">
                            <select class="dropdown-select">
                                <option value="">Selecione...</option>
                                <option value="circulo">Círculo</option>
                                <option value="quadrado">Quadrado</option>
                                <option value="octogono">Octógono</option>
                            </select>
                            <span class="dropdown-text">Selecione...</span>
                            <span class="dropdown-arrow">></span>
                            <span class="clear-btn">×</span>
                        </div>
                        <div class="dropdown-opcoes">
                            <span class="dropdown-item" data-value="circulo">Círculo</span>
                            <span class="dropdown-item" data-value="quadrado">Quadrado</span>
                            <span class="dropdown-item" data-value="octogono">Octógono</span>
                        </div>
                    </div>

                    <div class="form-grupo">
                        <label class="label-dropdown">Segunda forma</label>
                        <div class="dropdown-container">
                            <select class="dropdown-select">
                                <option value="">Selecione...</option>
                                <option value="circulo">Círculo</option>
                                <option value="quadrado">Quadrado</option>
                                <option value="octogono">Octógono</option>
                            </select>
                            <span class="dropdown-text">Selecione...</span>
                            <span class="dropdown-arrow">></span>
                            <span class="clear-btn">×</span>
                        </div>
                        <div class="dropdown-opcoes">
                            <span class="dropdown-item" data-value="circulo">Círculo</span>
                            <span class="dropdown-item" data-value="quadrado">Quadrado</span>
                            <span class="dropdown-item" data-value="octogono">Octógono</span>
                        </div>
                    </div>

                    <div class="form-grupo">
                        <label class="label-dropdown">Terceira forma</label>
                        <div class="dropdown-container">
                            <select class="dropdown-select">
                                <option value="">Selecione...</option>
                                <option value="circulo">Círculo</option>
                                <option value="quadrado">Quadrado</option>
                                <option value="octogono">Octógono</option>
                            </select>
                            <span class="dropdown-text">Selecione...</span>
                            <span class="dropdown-arrow">></span>
                            <span class="clear-btn">×</span>
                        </div>
                        <div class="dropdown-opcoes">
                            <span class="dropdown-item" data-value="circulo">Círculo</span>
                            <span class="dropdown-item" data-value="quadrado">Quadrado</span>
                            <span class="dropdown-item" data-value="octogono">Octógono</span>
                        </div>
                    </div>
                </div>

                <div class="coluna-pino oculto" id="coluna-pino-2">
                    <div class="titulo-pino">Ordem 2º pino</div>
                    
                    <div class="form-grupo">
                        <label class="label-dropdown">Primeira forma</label>
                        <div class="dropdown-container">
                            <select class="dropdown-select">
                                <option value="">Selecione...</option>
                                <option value="circulo">Círculo</option>
                                <option value="quadrado">Quadrado</option>
                                <option value="octogono">Octógono</option>
                            </select>
                            <span class="dropdown-text">Selecione...</span>
                            <span class="dropdown-arrow">></span>
                            <span class="clear-btn">×</span>
                        </div>
                        <div class="dropdown-opcoes">
                            <span class="dropdown-item" data-value="circulo">Círculo</span>
                            <span class="dropdown-item" data-value="quadrado">Quadrado</span>
                            <span class="dropdown-item" data-value="octogono">Octógono</span>
                        </div>
                    </div>

                    <div class="form-grupo">
                        <label class="label-dropdown">Segunda forma</label>
                        <div class="dropdown-container">
                            <select class="dropdown-select">
                                <option value="">Selecione...</option>
                                <option value="circulo">Círculo</option>
                                <option value="quadrado">Quadrado</option>
                                <option value="octogono">Octógono</option>
                            </select>
                            <span class="dropdown-text">Selecione...</span>
                            <span class="dropdown-arrow">></span>
                            <span class="clear-btn">×</span>
                        </div>
                        <div class="dropdown-opcoes">
                            <span class="dropdown-item" data-value="circulo">Círculo</span>
                            <span class="dropdown-item" data-value="quadrado">Quadrado</span>
                            <span class="dropdown-item" data-value="octogono">Octógono</span>
                        </div>
                    </div>

                    <div class="form-grupo">
                        <label class="label-dropdown">Terceira forma</label>
                        <div class="dropdown-container">
                            <select class="dropdown-select">
                                <option value="">Selecione...</option>
                                <option value="circulo">Círculo</option>
                                <option value="quadrado">Quadrado</option>
                                <option value="octogono">Octógono</option>
                            </select>
                            <span class="dropdown-text">Selecione...</span>
                            <span class="dropdown-arrow">></span>
                            <span class="clear-btn">×</span>
                        </div>
                        <div class="dropdown-opcoes">
                            <span class="dropdown-item" data-value="circulo">Círculo</span>
                            <span class="dropdown-item" data-value="quadrado">Quadrado</span>
                            <span class="dropdown-item" data-value="octogono">Octógono</span>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <footer id="main-footer">
        <div class="container footer-container">
            <div class="footer-top">
                <p class="footer-logo">CiberTech</p>
                <nav class="footer-nav">
                    <a href="#funcionalidades" class="footer-link">Funcionalidades</a>
                    <a href="#" class="footer-link">Termos de Uso</a>
                    <a href="#" class="footer-link">Contato</a>
                </nav>
            </div>
            <p class="footer-copy">
                &copy; 2025 CiberTech. Todos os direitos reservados.
            </p>
        </div>
    </footer>

    <script src="../js/auth.js"></script>
    <script>
        verificarLogin();
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- 1. LÓGICA DE EXIBIR/OCULTAR COLUNA DUPLA ---
            const radioSimples = document.getElementById('simples');
            const radioDupla = document.getElementById('dupla');
            const coluna2 = document.getElementById('coluna-pino-2');
            const painelDireito = document.getElementById('painel-configuracao');
            const preview2 = document.getElementById("preview-peca-2");

            function atualizarLayout() {
                if (radioDupla.checked) {
                    coluna2.classList.remove('oculto');
                    preview2.classList.remove('oculto');
                    painelDireito.classList.add('modo-duplo');
                } else {
                    coluna2.classList.add('oculto');
                    preview2.classList.add('oculto');
                    painelDireito.classList.remove('modo-duplo');
                }
            }

            radioSimples.addEventListener('change', atualizarLayout);
            radioDupla.addEventListener('change', atualizarLayout);
            
            // Executa ao carregar para garantir o estado correto
            atualizarLayout();


            // --- 2. LÓGICA DOS DROPDOWNS (COM ESCOPO POR PINO) ---
            
            // Esta função inicializa a lógica para uma coluna específica (pino 1 ou pino 2)
            // assim o que acontece no pino 1 não bloqueia o pino 2.
            function iniciarLogicaPino(idColuna) {
                const coluna = document.getElementById(idColuna);
                const formGroups = coluna.querySelectorAll('.form-grupo');
                const allSelects = coluna.querySelectorAll('.dropdown-select');
                const allOptionGroups = coluna.querySelectorAll('.dropdown-opcoes');

                function updateAvailableOptions() {
                    const selectedValues = new Set();
                    allSelects.forEach(select => {
                        if (select.value) selectedValues.add(select.value);
                    });

                    allOptionGroups.forEach(optionsContainer => {
                        const currentSelect = optionsContainer.closest('.form-grupo').querySelector('.dropdown-select');
                        
                        optionsContainer.querySelectorAll('.dropdown-item').forEach(item => {
                            const itemValue = item.dataset.value;
                            if (selectedValues.has(itemValue) && itemValue !== currentSelect.value) {
                                item.classList.add('desabilitado');
                            } else {
                                item.classList.remove('desabilitado');
                            }
                        });
                    });
                }
            
                // Configurar eventos para cada dropdown DENTRO desta coluna
                formGroups.forEach(group => {
                    const container = group.querySelector('.dropdown-container');
                    const selectElement = group.querySelector('.dropdown-select');
                    const dropdownOpcoes = group.querySelector('.dropdown-opcoes');
                    const clearBtn = group.querySelector('.clear-btn'); // <-- AGORA EXISTE

                    container.addEventListener('click', function(event) {
                        event.stopPropagation();
                        allOptionGroups.forEach(otherOptions => {
                            if (otherOptions !== dropdownOpcoes) otherOptions.style.display = 'none';
                        });
                        dropdownOpcoes.style.display =
                            dropdownOpcoes.style.display === 'none' ? 'block' : 'none';
                    });

                    dropdownOpcoes.querySelectorAll('.dropdown-item').forEach(item => {
                        item.addEventListener('click', function(event) {
                            event.stopPropagation();
                            if (item.classList.contains('desabilitado')) return;

                            const textoDisplay = container.querySelector('.dropdown-text');
                            selectElement.value = item.dataset.value;

                            // ATUALIZA O TEXTO VISUAL DO DROPDOWN
                            textoDisplay.textContent = item.textContent;

                            dropdownOpcoes.style.display = 'none';
                            updateAvailableOptions();
                        });
                    });

                    // ------ BOTÃO X ------
                    if (clearBtn) {
                        clearBtn.addEventListener('click', function(event) {
                                event.stopPropagation();
                                selectElement.value = "";
                                const textoDisplay = container.querySelector('.dropdown-text');
                                textoDisplay.textContent = "Selecione...";
                                updateAvailableOptions();
                            dropdownOpcoes.style.display = 'none';
                        });
                    }
                });
            }

            // Inicializa a lógica independente para cada coluna
            iniciarLogicaPino('coluna-pino-1');
            iniciarLogicaPino('coluna-pino-2');

            // Fechar dropdowns ao clicar fora (Global)
            document.addEventListener('click', function(event) {
                document.querySelectorAll('.dropdown-opcoes').forEach(opcoes => {
                    opcoes.style.display = 'none';
                });
            });

            // --- 3. LÓGICA DE ATUALIZAÇÃO DO PNG DO PREVIEW ---
            const previewImg = document.getElementById("preview-peca");

            // Mapeamento dos valores dos dropdowns para letras do arquivo
            const mapaLetras = {
                "circulo": "C",
                "quadrado": "Q",
                "octogono": "O"
            };

            // Atualiza a imagem conforme as escolhas do Pino 1
            function atualizarPreviewPino1() {
                const pino1 = document.getElementById("coluna-pino-1");
                const selects = pino1.querySelectorAll(".dropdown-select");

                let ordem = "";

                selects.forEach(sel => {
                    if (sel.value && mapaLetras[sel.value]) {
                        ordem += mapaLetras[sel.value];
                    }
                });

                // Se nada foi selecionado → volta imagem base
                if (ordem === "") {
                    previewImg.src = "../img/pngs/Base.png";
                    return;
                }

                // Montar caminho da imagem correspondente
                const novoPNG = `../img/pngs/${ordem}.png`;

                // Atualizar imagem
                previewImg.src = novoPNG;
            }

            // --- 4. LÓGICA DE ATUALIZAÇÃO DO PNG DO 2º PINO ---
            const previewImg2 = document.getElementById("preview-peca-2");

            function atualizarPreviewPino2() {
                const pino2 = document.getElementById("coluna-pino-2");
                const selects2 = pino2.querySelectorAll(".dropdown-select");

                let ordem2 = "";

                selects2.forEach(sel => {
                    if (sel.value && mapaLetras[sel.value]) {
                        ordem2 += mapaLetras[sel.value];
                    }
                });

                if (ordem2 === "") {
                    previewImg2.src = "../img/pngs/Base.png";
                    return;
                }

                const novoPNG2 = `../img/pngs/${ordem2}.png`;
                previewImg2.src = novoPNG2;
            }

            // Monitorar itens do dropdown (seleção)
            document.querySelectorAll("#coluna-pino-2 .dropdown-item").forEach(item => {
                item.addEventListener("click", atualizarPreviewPino2);
            });

            // Monitorar botões X
            document.querySelectorAll("#coluna-pino-2 .clear-btn").forEach(btn => {
                btn.addEventListener("click", atualizarPreviewPino2);
            });

            // Monitorar mudanças de TODOS os dropdowns do pino 1
            document.querySelectorAll("#coluna-pino-1 .dropdown-item").forEach(item => {
                item.addEventListener("click", atualizarPreviewPino1);
            });

            // Monitorar clique no botão de limpar (X)
            document.querySelectorAll("#coluna-pino-1 .clear-btn").forEach(btn => {
                btn.addEventListener("click", atualizarPreviewPino1);
            });
        });
    </script>
</body>
</html>